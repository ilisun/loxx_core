# Дорожная карта разработки библиотеки маршрутизации

## Итерация 1. Минимальное ядро и оффлайн-структура
**Цель:** получить работающий движок для Car/Foot, который умеет строить маршруты оффлайн.

- [ ] Написать парсер OSM (PBF) и конвертер в тайлы (land graph) → FlatBuffers.
- [ ] Реализовать C++ ядро: структуры графа, чтение тайлов, bi-A*.
- [ ] Реализовать CarProfile и FootProfile (скорости, доступность).
- [ ] C++ API `route(start,end,profile)` → polyline+длина+ETA.
- [ ] Собрать оффлайн-пакет для одного региона.
- [ ] Собрать .xcframework/.aar, интегрировать в простое демо-приложение (iOS/Android).

## Итерация 2. Геокодинг (оффлайн поиск)
**Цель:** дать возможность поиска адресов/POI оффлайн.

- [ ] Сгенерировать SQLite FTS5 + R-tree индекс из OSM (адреса, улицы, POI).
- [ ] Реализовать C++ модуль геокодинга, API `search(text,bbox)`.
- [ ] Интегрировать в ядро.
- [ ] Проверить работу в демо-приложении.

## Итерация 3. BoatProfile (реки, каналы)
**Цель:** добавить профиль для воды на основе `waterway=*` (без открытой воды).

- [ ] Парсить `waterway`-линии, строить водный граф в тайлах.
- [ ] Реализовать BoatProfile (скорость, доступность).
- [ ] API `routeBoat(start,end)` → polyline+ETA.
- [ ] Тесты: маршрут по реке/каналу.

## Итерация 4. BoatProfile (открытая вода, обход островов)
**Цель:** дать возможность маршрутизации по озёрам/морю.

- [ ] Сгенерировать grid/navmesh из полигона воды (вода/суша).
- [ ] Реализовать A* по grid/navmesh, пост-сглаживание.
- [ ] Стыковка waterway↔grid.
- [ ] API: смешанный маршрут по воде.

## Итерация 5. Инкрементальное перестроение
**Цель:** ускорить рероут при отклонениях.

- [ ] Добавить хранение коридора маршрута.
- [ ] Реализовать алгоритм инкрементального пересчёта (только нужный участок).
- [ ] Тесты: отклонение от маршрута → быстрый пересчёт.

## Итерация 6. Улучшения качества и скорости
**Цель:** оптимизация для мобильных устройств.

- [ ] Contraction Hierarchies для Car/Foot.
- [ ] Мульти-масштаб для water grid.
- [ ] Снижение потребления памяти, LRU-кэш тайлов.

## Итерация 7. API и сервер
**Цель:** предоставить онлайн-режим.

- [ ] Лёгкий HTTP сервер вокруг ядра: `POST /route`, `GET /search`.
- [ ] Нагрузочные тесты.
- [ ] Документация REST API.

## Итерация 8. Сборка SDK и обновления данных
**Цель:** удобная интеграция и обновление данных.

- [ ] Скрипты сборки .xcframework/.aar.
- [ ] Механизм скачивания/обновления оффлайн-пакетов в приложениях.
- [ ] Версионирование схемы и данных.

